<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>通过XMLHttpRequest获取音频流</title>
    <style>
        #mainContent {
            width: 500px;
            height: 300px;
            background-color: skyblue;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: auto;
            color: aliceblue;
        }
        p { word-wrap:break-word; }
    </style>
</head>
<body>
<div id="mainContent">
    <ul>
        <li>通过异步请求获取audio track</li>
        <li><button id="start">开始</button></li>
    </ul>
</div>

</body>
<script>
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    var audioCtx;
   var url = 'https://mdn.github.io/voice-change-o-matic/audio/concert-crowd.ogg';

   document.getElementById("start").onclick = function () {
       if (!window.AudioContext) {
           alert('您的浏览器不支持AudioContext');
       } else {
           //创建上下文
           audioCtx = new AudioContext();
           var source = null;
           //使用Ajax获取音频文件
           var request = new XMLHttpRequest();
           request.open('GET', url, true);
           request.responseType = 'arraybuffer';//配置数据的返回类型

           // 加载完成
           request.onload = function () {
               var arraybuffer = request.response;
               audioCtx.decodeAudioData(arraybuffer, function (buffer) {
                   // 处理成功返回的数据类型为AudioBuffer
                   // 创建AudioBufferSourceNode对象
                   source = audioCtx.createBufferSource();
                   source.buffer = buffer;
                   source.connect(audioCtx.destination);
                   // 指定位置开始播放
                   source.start(0);
               }, function (e) {
                   console.error(e.toString());
               });
           };
           request.send();
       }
   }
</script>
</html>