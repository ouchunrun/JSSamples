<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>webAudio播放通过设备获取的流</title>
    <style>
        #mainContent {
            width: 500px;
            height: 300px;
            background-color: skyblue;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: auto;
            color: aliceblue;
        }
        p { word-wrap:break-word; }
    </style>
</head>
<body>
<div id="mainContent">
    <ul>
        <li>播放从设备获取的流</li>
        <li><button id="start">开始</button></li>
        <li><button id="stop">结束</button></li>
    </ul>
</div>

</body>
<script>
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    var audioCtx;
    var oscillator;

    document.getElementById("start").onclick = function () {
        // 创建音频上下文
        audioCtx = new AudioContext();
        if (navigator.mediaDevices.getUserMedia) {
            console.log('getUserMedia supported.');
            var constraints = {audio: true};
            navigator.mediaDevices.getUserMedia (constraints)
                .then(
                    function(stream) {
                        source = audioCtx.createMediaStreamSource(stream);
                        source.connect(audioCtx.destination);
                    })
                .catch( function(err) { console.log('The following gUM error occured: ' + err);})
        } else {
            console.error('getUserMedia not supported on your browser!');
        }

    };

    document.getElementById("stop").onclick = function () {
        oscillator.stop();
    }

</script>
</html>